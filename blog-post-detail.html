<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Loading Blog Post...</title>
    <!-- Load Tailwind CSS from CDN (Tailwind warning is expected in console for CDN usage) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font globally and set a base text color */
        body {
            font-family: 'Inter', sans-serif;
            color: #333; /* Dark gray for good readability */
            background-color: #f9fafb; /* Light gray background */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Basic styling for content within the blog post - for TinyMCE rendered HTML */
        .prose {
            /* Basic resets to make TinyMCE output look good with Tailwind */
            max-width: none; /* Override default prose max-width if present */
            color: #333;
            line-height: 1.7;
        }
        .prose p {
            margin-bottom: 1em;
        }
        .prose ul, .prose ol {
            margin-bottom: 1em;
            padding-left: 1.5em; /* Default list indent */
            list-style-type: disc; /* Default bullet style for ul */
        }
        .prose ol {
            list-style-type: decimal; /* Default number style for ol */
        }
        .prose li {
            margin-bottom: 0.5em;
        }
        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
            margin-top: 1.5em;
            margin-bottom: 0.75em;
            font-weight: bold;
            color: #1a202c; /* Darker heading color */
        }
        .prose h1 { font-size: 2.25em; } /* 36px */
        .prose h2 { font-size: 1.75em; } /* 28px */
        .prose h3 { font-size: 1.5em; } /* 24px */
        .prose h4 { font-size: 1.25em; } /* 20px */
        .prose a {
            color: #4c51bf; /* Indigo for links */
            text-decoration: underline;
        }
        .prose img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem; /* rounded-lg */
            margin-top: 1em;
            margin-bottom: 1em;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        /* Add other styles for elements TinyMCE might output, like strong, em, table, etc. */
        .prose strong { font-weight: bold; }
        .prose em { font-style: italic; }
        .prose table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1em;
        }
        .prose th, .prose td {
            border: 1px solid #e2e8f0; /* gray-300 */
            padding: 0.5em;
            text-align: left;
        }
        .prose blockquote {
            border-left: 4px solid #4c51bf; /* Indigo border */
            padding-left: 1em;
            margin-left: 0;
            font-style: italic;
            color: #4a5568; /* gray-600 */
        }
    </style>
</head>
<body>

    <!-- Header Section (Similar to homepage for consistent navigation) -->
    <header class="bg-white shadow-md p-4 sticky top-0 z-50 rounded-b-lg">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <!-- Logo/Site Title -->
            <a href="index.html" class="text-3xl font-bold text-indigo-700 hover:text-indigo-900 transition duration-300">
                Siam's Insight
            </a>

            <!-- Navigation Menu -->
            <nav class="mt-4 md:mt-0">
                <ul class="flex flex-wrap justify-center space-x-4 md:space-x-8">
                    <li><a href="index.html#home" class="text-gray-700 hover:text-indigo-600 font-medium transition duration-300 p-2 rounded-md">Home</a></li>
                    <li><a href="index.html#blog" class="text-gray-700 hover:text-indigo-600 font-medium transition duration-300 p-2 rounded-md">Blog</a></li>
                    <li><a href="index.html#premium-notes" class="text-gray-700 hover:text-indigo-600 font-medium transition duration-300 p-2 rounded-md">Premium Notes</a></li>
                    <li><a href="index.html#about" class="text-gray-700 hover:text-indigo-600 font-medium transition duration-300 p-2 rounded-md">About</a></li>
                    <li><a href="index.html#contact" class="text-gray-700 hover:text-indigo-600 font-medium transition duration-300 p-2 rounded-md">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Blog Post Content Section -->
    <section class="container mx-auto py-12 px-4">
        <div id="blogPostContent" class="bg-white p-8 rounded-lg shadow-xl">
            <!-- Content will be loaded here by JavaScript -->
            <p class="text-center text-gray-600 text-lg">Loading blog post...</p>
        </div>
    </section>

    <!-- Footer Section (Same as homepage for consistency) -->
    <footer class="bg-gray-900 text-gray-300 py-12 px-4 rounded-t-lg mt-4">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12 text-center md:text-left">
            <!-- About Section in Footer -->
            <div class="mb-6 md:mb-0">
                <h3 class="text-2xl font-bold text-white mb-4">Shifat Shahriar Siam</h3>
                <p class="text-sm leading-relaxed">
                    A personal platform for sharing knowledge and resources in Public Health and Informatics. Committed to exploring data-driven solutions for a healthier future.
                </p>
            </div>

            <!-- Contact Info in Footer -->
            <div class="mb-6 md:mb-0">
                <h3 class="text-xl font-semibold text-white mb-4">Contact Info</h3>
                <p class="text-sm mb-2">
                    21 no Hall, Jahangirnagar University, Savar-1342, Dhaka
                </p>
                <p class="text-sm">
                    Email: <a href="mailto:20212954156siam@juniv.edu" class="text-indigo-300 hover:text-indigo-100 transition duration-200">20212954156siam@juniv.edu</a>
                </p>
            </div>

            <!-- Follow Me (Socials) in Footer -->
            <div>
                <h3 class="text-xl font-semibold text-white mb-4">Follow Me</h3>
                <div class="flex justify-center md:justify-start space-x-6">
                    <!-- Facebook Icon -->
                    <a href="https://www.facebook.com/shifat.shahriar.siam.2002" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-500 transition duration-300">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M14 13.5h2.5l1-4H14V6.75c0-1.03.462-1.724 1.724-1.724H18V.542S16.536.25 15.154.25c-2.906 0-4.831 1.76-4.831 4.966V9.5H7.5v4H10v10h4v-10z"/></svg>
                    </a>
                    <!-- Instagram Icon -->
                    <a href="https://www.instagram.com/ss_siam07/" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-pink-500 transition duration-300">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2.163c3.204 0 3.584.012 4.85.07c1.173.055 1.832.249 2.227.42.404.183.74.45.98.815.24.364.409.773.473 1.25.064.467.075.66.075 4.85s-.011 4.383-.075 4.85c-.064.477-.233.886-.473 1.25-.24.365-.576.632-.98.815-.395.171-1.054.365-2.227.42-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.173-.055-1.832-.249-2.227-.42-.404-.183-.74-.45-.98-.815-.24-.364-.409-.773-.473-1.25-.064-.467-.075-.66-.075-4.85s.011-4.383.075-4.85c.064-.477.233-.886.473-1.25.24-.365.576-.632.98-.815.395-.171 1.054-.365 2.227.42 1.266-.058 1.646-.07 4.85-.07zm0-2.163C8.615 0 8.243.012 6.95.07c-1.298.06-2.104.28-2.67.536-.575.26-.995.602-1.37.975-.375.373-.717.793-.975 1.368-.256.566-.476 1.372-.536 2.67-.058 1.29-.07 1.662-.07 5.055s.012 3.765.07 5.055c.06.85.205 1.54.437 2.18.232.63.565 1.13.975 1.54.409.408.84.735 1.368.975.566.256 1.372.476 2.67.536 1.29.058 1.662.07 5.055.07s3.765-.012 5.055-.07c.85-.06 1.54-.205 2.18-.437.63-.232 1.13-.565 1.54-.975.409-.408.735-.84.975-1.368.256-.566.476-1.372.536-2.67-.058-1.29-.07-1.662-.07-5.055s-.012-3.765-.07-5.055c-.06-.85-.205-1.54-.437-2.18-.232-.63-.565-1.13-.975-1.54-.409-.408-.84-.735-1.368-.975-.566-.256-1.372-.476-2.67-.536-1.29-.058-1.662-.07-5.055-.07zm0 5.48c-2.484 0-4.5 2.015-4.5 4.5s2.016 4.5 4.5 4.5 4.5-2.015 4.5-4.5-2.016-4.5-4.5-4.5zm0 7.37c-1.583 0-2.87-1.287-2.87-2.87s1.287-2.87 2.87-2.87 2.87 1.287 2.87 2.87-1.287 2.87-2.87 2.87zm4.325-7.79c-.588 0-1.066.478-1.066 1.066s.478 1.066 1.066 1.066 1.066-.478 1.066-1.066-.478-1.066-1.066-1.066z"/></svg>
                    </a>
                    <!-- X (Twitter) Icon -->
                    <a href="https://x.com/realDonaldTrump" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-400 transition duration-300">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M18.244 2.25h3.308l-7.227 8.26L21.61 22H14.98L9.635 14.187l-6.233 7.813H.426l7.73-9.88L.426 2.25H8.08L12.38 8.53 18.244 2.25zM17.292 20l-5.437-6.9L6.162 4h-2.1L12.292 20h5.0zm.685-3.08l-5.437-6.9-6.162-8.02h-2.1L12.292 20h5.083z"/></svg>
                    </a>
                    <!-- YouTube Icon -->
                    <a href="https://www.youtube.com/@aparadisebird" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-red-600 transition duration-300">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19.615 3.184c-3.14-1.28-6.14-1.28-9.14 0C5.352 4.464 2 7.824 2 12s3.352 7.536 8.475 8.816C13.86 21.28 16.86 21.28 19.615 20.816c4.63-1.4 6.785-5.26 6.785-8.816S24.245 4.584 19.615 3.184zM16 12l-6-4v8l6-4z"/></svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="mt-8 pt-8 border-t border-gray-700 text-center text-sm text-gray-500">
            <p>&copy; 2025 Shifat Shahriar Siam. All Rights Reserved.</p>
        </div>
    </footer>
    <!-- Modals for Bkash Payment and Ad Watching (Remains the same) -->
    <div id="bkashModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Purchase <span id="bkashDocTitle" class="text-indigo-600"></span> via Bkash</h3>
            <p class="text-gray-700 mb-4">
                Please send the exact amount to my Bkash Personal Number: <strong class="text-green-700">01XXXXXXXXX</strong>.
            </p>
            <p class="text-gray-700 mb-6">
                After sending money, please submit the Transaction ID (TrxID) below. I will verify it manually and send the document link to your email.
            </p>
            <div class="mb-4">
                <label for="buyerNameBkash" class="block text-gray-700 text-sm font-bold mb-2 text-left">Your Full Name</label>
                <input type="text" id="buyerNameBkash" class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md" placeholder="Your Name">
            </div>
            <div class="mb-4">
                <label for="buyerEmailBkash" class="block text-gray-700 text-sm font-bold mb-2 text-left">Your Email Address</label>
                <input type="email" id="buyerEmailBkash" class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md" placeholder="john.doe@example.com">
            </div>
            <div class="mb-6">
                <label for="trxId" class="block text-gray-700 text-sm font-bold mb-2 text-left">Bkash Transaction ID (TrxID)</label>
                <input type="text" id="trxId" class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md" placeholder="ABC123XYZ789">
            </div>
            <div class="flex justify-end space-x-4">
                <button onclick="closeModal('bkashModal')" class="bg-gray-300 text-gray-800 hover:bg-gray-400 px-6 py-3 rounded-lg font-semibold transition duration-300">
                    Cancel
                </button>
                <button onclick="submitBkashOrder()" class="bg-indigo-600 text-white hover:bg-indigo-700 px-6 py-3 rounded-lg font-semibold transition duration-300">
                    Submit Order
                </button>
            </div>
        </div>
    </div>

    <div id="adModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Watch Ad to Access <span id="adDocTitle" class="text-indigo-600"></span></h3>
            <div id="adContainer" class="bg-gray-200 h-48 flex items-center justify-center text-gray-600 text-center rounded-md mb-6">
                <!-- AdSense Ad Unit will be dynamically placed here by JavaScript -->
                <p>Loading advertisement...</p>
            </div>
            <p class="text-gray-700 mb-6 text-center">
                Please watch the entire advertisement to unlock your document.
            </p>
            <div class="flex justify-end space-x-4">
                <button onclick="closeModal('adModal')" class="bg-gray-300 text-gray-800 hover:bg-gray-400 px-6 py-3 rounded-lg font-semibold transition duration-300">
                    Cancel
                </button>
                <button id="accessDocButton" onclick="accessDocumentAfterAd()" class="bg-green-600 text-white hover:bg-green-700 px-6 py-3 rounded-lg font-semibold transition duration-300 hidden">
                    Access Document
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript for Modal Functionality and Firebase Integration -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCGY3j4yIpHMkc4DOcFBhzs2hfEVsw0VJ0",
            authDomain: "siamwebsite2022.firebaseapp.com",
            projectId: "siamwebsite2022",
            storageBucket: "siamwebsite2022.firebasestorage.app",
            messagingSenderId: "964747721403",
            appId: "1:964747721403:web:1860b8c0533bcf6d6cc79e"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = app.firestore();
        const auth = app.auth();
        const storage = app.storage();

        // --- Functions for Frontend Dynamic Content ---
        const blogPostsGrid = document.getElementById('blogPostsGrid');
        const premiumDocumentsGrid = document.getElementById('premiumDocumentsGrid');

        // Function to truncate HTML content
        function truncateHtml(html, maxLength) {
            if (!html) return '';

            // Create a temporary div to parse the HTML and get plain text
            const div = document.createElement('div');
            div.innerHTML = html;
            let text = div.textContent || div.innerText || '';

            if (text.length <= maxLength) {
                return html; // Return full HTML if it's already short enough
            }

            let truncatedText = text.substring(0, maxLength);

            // Find the last complete word to avoid cutting words in half
            const lastSpace = truncatedText.lastIndexOf(' ');
            if (lastSpace > -1) {
                truncatedText = truncatedText.substring(0, lastSpace);
            }

            return truncatedText + '...'; // Add ellipsis
        }

        // Increment Like count for a blog post
        async function incrementLike(postId) {
            try {
                const postRef = db.collection('blogPosts').doc(postId);
                await postRef.update({
                    likes: firebase.firestore.FieldValue.increment(1)
                });
                console.log(`Liked post ${postId}`);
                // No need to reload specific card if real-time listener is active on blogPostsGrid (but it's not currently, only on admin)
                // For live update on homepage, you would need to implement an onSnapshot listener here for 'blogPosts'
            } catch (error) {
                console.error("Error liking post:", error);
            }
        }

        // Increment Dislike count for a blog post
        async function incrementDislike(postId) {
            try {
                const postRef = db.collection('blogPosts').doc(postId);
                await postRef.update({
                    dislikes: firebase.firestore.FieldValue.increment(1)
                });
                console.log(`Disliked post ${postId}`);
            } catch (error) {
                console.error("Error disliking post:", error);
            }
        }

        // Load Blog Posts from Firestore
        async function loadBlogPosts() {
            blogPostsGrid.innerHTML = '<p class="text-gray-600 text-center col-span-full">Loading blog posts...</p>';
            try {
                const snapshot = await db.collection('blogPosts').orderBy('date', 'desc').get();
                blogPostsGrid.innerHTML = '';

                if (snapshot.empty) {
                    blogPostsGrid.innerHTML = '<p class="text-gray-600 text-center col-span-full">No blog posts published yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const post = doc.data();
                    const postId = doc.id; // Get the document ID for interaction
                    const postDate = new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    
                    const truncatedContent = truncateHtml(post.content, 200); // Adjust 200 for desired preview length

                    const postElement = `
                        <article class="bg-gray-50 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden">
                            <img src="${post.imageUrl || 'https://placehold.co/600x400/9ca3af/ffffff?text=Blog+Image'}" alt="${post.title}" class="w-full h-48 object-cover rounded-t-lg" onerror="this.onerror=null;this.src='https://placehold.co/600x400/9ca3af/ffffff?text=Image+Missing';">
                            <div class="p-6">
                                <a href="blog-post-detail.html?slug=${post.slug}" class="block">
                                    <h3 class="text-2xl font-semibold text-gray-900 mb-3 hover:text-indigo-700 transition duration-300">${post.title}</h3>
                                </a>
                                <p class="text-gray-700 mb-4">${truncatedContent}</p>
                                <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                                    <span>By <a href="index.html#about" class="text-indigo-600 hover:underline">${post.author}</a></span>
                                    <span>${postDate}</span>
                                </div>
                                <a href="blog-post-detail.html?slug=${post.slug}" class="text-indigo-600 hover:text-indigo-800 font-semibold flex items-center mb-4">
                                    Read More
                                    <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                                </a>
                                <!-- Like, Dislike, Views Buttons -->
                                <div class="flex items-center justify-between text-sm text-gray-600 mt-4 pt-4 border-t border-gray-200">
                                    <div class="flex items-center space-x-3">
                                        <button onclick="incrementLike('${postId}')" class="flex items-center text-green-600 hover:text-green-700 transition duration-200">
                                            <svg class="w-5 h-5 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-thumbs-up"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>
                                            <span>${post.likes || 0}</span>
                                        </button>
                                        <button onclick="incrementDislike('${postId}')" class="flex items-center text-red-600 hover:text-red-700 transition duration-200">
                                            <svg class="w-5 h-5 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-thumbs-down"><path d="M10 15V19a3 3 0 0 0 3 3l4-9V3H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zM17 2H20a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-3"></path></svg>
                                            <span>${post.dislikes || 0}</span>
                                        </button>
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="w-5 h-5 mr-1 text-gray-500" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
                                        <span>${post.views || 0} Views</span>
                                    </div>
                                </div>
                            </div>
                        </article>
                    `;
                    blogPostsGrid.innerHTML += postElement;
                });
            } catch (error) {
                console.error("Error loading blog posts:", error);
                blogPostsGrid.innerHTML = '<p class="text-red-500 text-center col-span-full">Error loading blog posts. Please try again later.</p>';
            }
        }

        // Load Premium Documents from Firestore
        async function loadPremiumDocuments() {
            premiumDocumentsGrid.innerHTML = '<p class="text-gray-600 text-center col-span-full">Loading premium documents...</p>';
            try {
                const snapshot = await db.collection('premiumDocuments').get();
                premiumDocumentsGrid.innerHTML = '';

                if (snapshot.empty) {
                    premiumDocumentsGrid.innerHTML = '<p class="text-gray-600 text-center col-span-full">No premium documents available yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const document = doc.data();
                    let buttonsHtml = '';

                    const allowBkash = !!document.allowBkash;
                    const allowAd = !!document.allowAd;

                    if (allowBkash) {
                        buttonsHtml += `
                            <button onclick="showBkashPaymentModal('${document.name}')" class="w-full bg-indigo-600 text-white hover:bg-indigo-700 px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition duration-300 ease-in-out mb-2">
                                Buy via Bkash
                            </button>
                        `;
                    }
                    if (allowAd) {
                        buttonsHtml += `
                            <button onclick="showAdModal('${document.name}')" class="w-full bg-yellow-500 text-gray-900 hover:bg-yellow-600 px-6 py-3 rounded-lg font-semibold shadow-md transform hover:scale-105 transition duration-300 ease-in-out">
                                Watch Ad to Access (Free)
                            </button>
                        `;
                    }
                    if (!allowBkash && !allowAd) {
                        buttonsHtml = '<p class="text-gray-500 text-center text-sm">Access options not available for this document.</p>';
                    }


                    const docElement = `
                        <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden">
                            <img src="${document.previewImageUrl || 'https://placehold.co/600x400/d1d5db/4b5563?text=Document+Preview'}" alt="${document.name}" class="w-full h-48 object-cover rounded-t-lg" onerror="this.onerror=null;this.src='https://placehold.co/600x400/d1d5db/4b5563?text=Image+Missing';">
                            <div class="p-6">
                                <h3 class="text-2xl font-semibold text-gray-900 mb-3">${document.name}</h3>
                                <p class="text-gray-700 mb-4 line-clamp-3">${document.description}</p>
                                <div class="flex items-center justify-between mb-6">
                                    <span class="text-3xl font-bold text-green-700">BDT ${document.priceBDT || 'N/A'}</span>
                                    <span class="text-sm text-gray-500 italic">${document.pages || 'N/A'} pages</span>
                                </div>
                                <div class="flex flex-col space-y-3">
                                    ${buttonsHtml}
                                </div>
                            </div>
                        </div>
                    `;
                    premiumDocumentsGrid.innerHTML += docElement;
                });
            } catch (error) {
                console.error("Error loading premium documents:", error);
                premiumDocumentsGrid.innerHTML = '<p class="text-red-500 text-center col-span-full">Error loading premium documents. Please try again later.</p>';
            }
        }


        // Run functions to load data when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadBlogPosts();
            loadPremiumDocuments();
        });

        // Function to show a modal (remains same)
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        // Function to close a modal (remains same)
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Show Bkash payment modal (remains same)
        function showBkashPaymentModal(docTitle) {
            document.getElementById('bkashDocTitle').textContent = docTitle;
            showModal('bkashModal');
        }

        // Function to submit Bkash order to Firestore (remains same)
        async function submitBkashOrder() {
            const docTitle = document.getElementById('bkashDocTitle').textContent;
            const buyerName = document.getElementById('buyerNameBkash').value;
            const buyerEmail = document.getElementById('buyerEmailBkash').value;
            const trxId = document.getElementById('trxId').value;

            if (!buyerName || !buyerEmail || !trxId) {
                alert('Please fill in all fields.');
                return;
            }

            let userId = null;
            try {
                const userCredential = await auth.signInAnonymously();
                userId = userCredential.user.uid;
                console.log("Signed in anonymously with UID:", userId);
            } catch (error) {
                console.error("Authentication error during order:", error);
                alert("Authentication error during order. Please try again. (Check console for details)");
                return;
            }

            let documentData = null;
            let documentFirestoreId = null;
            try {
                const docSnapshot = await db.collection('premiumDocuments').where('name', '==', docTitle).limit(1).get();
                if (!docSnapshot.empty) {
                    documentData = docSnapshot.docs[0].data();
                    documentFirestoreId = docSnapshot.docs[0].id;
                } else {
                    alert('Error: Document details not found for purchase. Please contact support.');
                    console.error('Premium document not found in Firestore for title:', docTitle);
                    return;
                }
            } catch (error) {
                console.error("Error fetching document details for order:", error);
                alert("Error fetching document details for purchase. Please try again. (Check console for details)");
                return;
            }

            try {
                await db.collection('bkashOrders').add({
                    documentName: docTitle,
                    buyerName: buyerName,
                    buyerEmail: buyerEmail,
                    bkashTrxId: trxId,
                    orderDate: new Date().toISOString(),
                    status: 'pending',
                    userId: userId,
                    documentFirestoreId: documentFirestoreId,
                    documentUrl: documentData.externalDownloadUrl || ''
                });
                alert('Your order has been submitted successfully! You will receive an email upon verification. Thank you!');
                closeModal('bkashModal');
                document.getElementById('buyerNameBkash').value = '';
                document.getElementById('buyerEmailBkash').value = '';
                document.getElementById('trxId').value = '';
            } catch (error) {
                console.error("Error adding order document to Firestore:", error);
                alert("There was an error submitting your order. Please try again. (Check console for details)");
            }
        }

        // Show Ad modal (remains same, with AdSense integration)
        function showAdModal(docTitle) {
            document.getElementById('adDocTitle').textContent = docTitle;
            document.getElementById('accessDocButton').classList.add('hidden');
            document.getElementById('adContainer').innerHTML = '<p class="text-center text-gray-600">Loading advertisement...</p>';

            showModal('adModal');

            const adUnitHtml = `
                <ins class="adsbygoogle"
                     style="display:block; text-align:center; min-height: 100px; min-width: 100px;"
                     data-ad-client="ca-pub-6894065582382364"
                     data-ad-slot="1570571656"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
            `;
            document.getElementById('adContainer').innerHTML = adUnitHtml;

            if (window.adsbygoogle && window.adsbygoogle.push) {
                (window.adsbygoogle = window.adsbygoogle || []).push({});
            } else {
                console.warn("AdSense script not loaded or not ready. Ad might not display.");
            }

            setTimeout(() => {
                document.getElementById('adContainer').innerHTML = `
                    <div class="flex flex-col items-center justify-center p-4">
                        <svg class="w-16 h-16 text-green-500 mb-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <p class="text-green-700 font-bold text-lg">Ad watched successfully!</p>
                        <p class="text-gray-500 text-sm mt-1">Access button will appear shortly.</p>
                    </div>
                `;
                document.getElementById('accessDocButton').classList.remove('hidden');
            }, 3000);
        }

        // Simulate document access after ad (remains same)
        async function accessDocumentAfterAd() {
            const docTitle = document.getElementById('adDocTitle').textContent;
            let documentData = null;
            try {
                const docSnapshot = await db.collection('premiumDocuments').where('name', '==', docTitle).limit(1).get();
                if (!docSnapshot.empty) {
                    documentData = docSnapshot.docs[0].data();
                    const downloadUrl = documentData.externalDownloadUrl;
                    if (downloadUrl) {
                        alert(`Document "${docTitle}" is now accessible! Opening download link.`);
                        window.open(downloadUrl, '_blank');
                    } else {
                        alert(`Document "${docTitle}" is accessible, but no download link found. Please contact support.`);
                        console.error(`Download URL missing for document: ${docTitle}`);
                    }
                } else {
                    alert('Error: Premium document details not found for ad access. Please contact support.');
                    console.error('Premium document not found in Firestore for ad access for title:', docTitle);
                }
            } catch (error) {
                console.error("Error fetching document for ad access:", error);
                alert("Error accessing document after ad. Please try again. (Check console for details)");
            }
            closeModal('adModal');
        }

        // Smooth scrolling for navigation links (remains same)
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();

                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
